---

  - hosts: tag_Name_control_{{ lookup('env', 'DEPLOY') }}

    tasks:

      - name: stop consul
        service:
          name="consul"
          state="stopped"

      - name: clear raft data
        shell: rm -rf /var/consul/raft/*

      # TODO: configure /etc/consul/agent/config.json

      - name: bootstrap consul cluster
        service:
          name="consul"
          state="started"

      - name: settle...
        pause: seconds=15


  - hosts: tag_Name_control_{{ lookup('env', 'DEPLOY') }}

    serial: 1

    tasks:

      - name: stop consul
        service:
          name="consul"
          state="stopped"

      - name: settle...
        pause: seconds=5

      # TODO: configure /etc/consul/agent/config.json

      - name: start consul
        service:
          name="consul"
          state="started"
          enabled="yes"

      - name: settle...
        pause: seconds=5
