---

  - hosts: tag_Name_control_{{ lookup('env', 'DEPLOY') }}

    vars:

      config: >
        '{
          "Network": "192.168.0.0/16",
          "Backend": {
            "Type": "vxlan"
          }
        }'

    tasks:

      - name: print config
        debug:
          msg: "{{ config | replace('\n', '') }}"

      - name: set flannel config
        uri:
          url: http://etcd.service.consul:2379/v2/keys/flannel/network/config
          method: PUT
          body: "{{ config | replace('\n', '') }}"
          content_type: json
          return_content: yes
        run_once: yes
